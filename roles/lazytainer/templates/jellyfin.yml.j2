version: "3.8"
services:
  lazytainer:
    container_name: {{lazytainer_container_name}}
    image: {{lazytainer_image_name}}:{{lazytainer_image_version}}
    environment:
      - VERBOSE=true
    ports:
      - {{ jellyfin_port_http }}:8096
      - {{ jellyfin_port_https }}:8920
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
    labels:
      - "lazytainer.group.jellyfin.ports={{ jellyfin_port_http }},{{ jellyfin_port_https }}"
      - "lazytainer.group.jellyfin.inactiveTimeout={{ lazytainer_inactiveTimeout }}"
      - "lazytainer.group.jellyfin.minPacketThreshold={{ lazytainer_minPacketThreshold }}"
      - "lazytainer.group.jellyfin.pollRate={{ lazytainer_pollRate }}"
    
    jellyfin:
      image: "{{ jellyfin_image_name }}:{{ jellyfin_image_version }}"
      container_name: "{{ jellyfin_container_name }}"
      restart_policy: unless-stopped
      volumes:
        - "{{ jellyfin_config_directory }}:/config:rw"
        - "{{ jellyfin_movies_directory }}:/movies:{{ jellyfin_movies_permissions }}"
        - "{{ jellyfin_music_directory }}:/music:{{ jellyfin_music_permissions }}"
        - "{{ jellyfin_photos_directory }}:/photos:{{ jellyfin_photos_permissions }}"
        - "{{ jellyfin_tv_directory }}:/tv:{{ jellyfin_tv_permissions }}"
        - "{{ jellyfin_books_directory }}:/books:{{ jellyfin_books_permissions }}"
        - "{{ jellyfin_audiobooks_directory }}:/audiobooks:{{ jellyfin_audiobooks_permissions }}"
      environment:
        - "PUID:{{ jellyfin_user_id }}"
        - "PGID:{{ jellyfin_group_id }}"
        - "TZ:{{ ansible_nas_timezone }}"
      network_mode: service:lazytainer
      labels:
        - "lazytainer.group=jellyfin"
      depends_on:
        - lazytainer